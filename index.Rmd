---
title: "R Project"
author: "Ananya Jain, Mansi Agarwal, Saravana Chilamakuri"
date: "13/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r loading_libraries, include=FALSE}
library(dplyr)
library(tidytext)
library(janeaustenr)
library(stringr)
library(ggplot2)
library(gutenbergr)
library(tidyr)
library(scales)
library(ggthemes)
library(magrittr)
library(tidyverse)
library(textdata)
```

```{r gutenberg_corpus_download, include=FALSE}
#louisa <- gutenberg_download(c(28203, 8188, 37106, 2787, 2788, 4770, 38567, 41127, 3795, 2786), mirror = "http://mirrors.xmission.com/gutenberg/", meta_fields = c("title", "author"))
#twain <- gutenberg_download(c(3178, 74, 1837, 76, 86, 3179, 102, 91, 93), mirror = "http://mirrors.xmission.com/gutenberg/", meta_fields = c("title", "author"))
louisa <- read.csv("louisa.csv")
twain <- read.csv("twain.csv")
```

```{r corpus_creation, include=FALSE}
louisa_token <- louisa %>%
  group_by(author, title) %>%
  unnest_tokens(word, text) %>%
  anti_join(stop_words) %>%
  count(word, sort = FALSE)

twain$author <- twain$author %>%
  replace_na("Twain, Mark")

twain_token <- twain %>%
  group_by(author, title) %>%
  unnest_tokens(word, text) %>%
  anti_join(stop_words) %>%
  count(word, sort = FALSE)
```

```{r lexicon_definition, include=FALSE}
domestic_words <- c("home","door","bed","knife","window","hall","chair","palace","house","room","table","window","corner","chair","sofa","parlor","wall","supper")
domestic_df <- data.frame(word = domestic_words, domestic = TRUE)
outdoor_words <- c("river","raft","woods","boat","cave","sand","canoe","stream","shore","hill","railroad","steamboat","sea","mud","road","bank","sun","wild","moor","town","carriage","moss","city")
outdoor_df <- data.frame(word = outdoor_words, outdoor = TRUE)
```


```{r tagged_words, include=FALSE}
twain_tagged <- twain_token %>%
  left_join(domestic_df) %>%
  left_join(outdoor_df)

louisa_tagged <- louisa_token %>%
  left_join(domestic_df) %>%
  left_join(outdoor_df)
```

```{r calculate_words, include=FALSE}
twain_table <- twain_tagged %>% 
                     group_by(author) %>% 
                     count(domestic, outdoor) %>% 
                     mutate (percent = n/sum(n)*100)

twain_table

louisa_table <- louisa_tagged %>% 
                     group_by(author) %>% 
                     count(domestic, outdoor) %>% 
                     mutate (percent = n/sum(n)*100)

louisa_table
```

```{r bind rows, include=FALSE}
all_authors <- bind_rows(twain_table, louisa_table)
all_authors_tagged <- bind_rows(twain_tagged, louisa_tagged)
```

```{r relative_frequency_long, include=FALSE}
all_authors_frequency <- all_authors_tagged %>%
  group_by(title) %>%
  add_count(name = "length") %>%
  mutate(domestic_count = sum(domestic, na.rm = TRUE)) %>%
  mutate(relative_frequency = domestic_count / length) %>%
  select(author, title, relative_frequency) %>%
  distinct()
                          
```

```{r basic_histogram, include=FALSE}
all_authors_frequency %>%
  ggplot(aes(relative_frequency)) +
  geom_histogram()
```
```{r histogram_gender, include=FALSE}
all_authors_frequency %>%
  ggplot(aes(relative_frequency, fill = author)) +
  geom_histogram()
```

## Introduction and Research Question

Our research question draws from a <a href="https://elijah-samuel.github.io/voyant_project/">previous project</a> that found Alcott’s work to be more heavily populated with things that characterise the indoors, whereas Twain’s work was characterised by the outdoors. These findings were in line with the notion that women writing in the 19th century were more concerned with the domestic space as opposed to men who occupied themselves with more important things. While we know what space male and female authors occupied, we don’t necessarily know the sentiment surrounding that space. This paper is a step in that direction. It attempts to unpack the sentiment surrounding the indoor and outdoor space in the works of Louisa May Alcott and Mark Twain. It’s also useful in studying whether sentiment around indoor and outdoor functions as a binary. One might expect a positive portrayal of the indoor space to coincide with a negative portrayal of the outdoor space, and vice versa. While the results of a comparison between Twain and Alcott alone cannot be extrapolated to all the authors of that time, it is still useful as preliminary results can motivate studies at a larger scale and answer questions previously unanswered.

## Research Hypothesis

Given that Louisa May Alcott tends to write more intensely about the indoor space, as opposed to Mark Twain, who writes more about the outdoors, we expect sentiment to be positive around the indoor space in Alcott’s work and the outdoor space in Twain’s work, and negative in the outdoor space in Alcott’s work and the indoor space in Twain’s work.

## Corpus Description

Our corpus comprises 10 books by Louisa May Alcott and 9 books by Mark Twain. We were motivated by two reasons in choosing the authors. First, we wanted to be mindful of the time overlap between them, given word usage and popularity changes with time. Alcott’s novels span 1865-1886 and Twain’s novels span 1873-1896. Second, we wanted to use authors that deal differently with the indoors and outdoors. Louisa May Alcott, being female and upper-middle class, wrote more about the domestic space as compared to Mark Twain. Mark Twain, being male and lower class, wrote more plots set outdoors. We want to explore if a difference in setting brings with it a difference in the sentiment surrounding that setting. 

It’s also interesting to note that given the gender identities of the two authors, the indoor and outdoor space tends to imply multifarious gender roles for each of them. While the domestic space can act as a refuge for women, the outdoors can do the same for men of that time. Virginia Woolf’s Room of One’s Own is a seminal work, which talks about the importance of solitary space for women, acting as a catapult for creativity and imagination, whereas a lack of ‘one’s own’ space curbs the same. On the contrary, the overwhelming number of works about the adventures of men in the wild, including Tom Sawyer, Robinson Crusoe, Gulliver amongst many, act as their source of free-spirited inspiration. This intuitively affects the sentiments surrounding the indoor and outdoor space for men and women, which we intend to explore through our project.

## Summary

To prove/disprove our hypothesis, the project uses the works of Mark Twain and Louisa May Alcott. The corpus comprises 9 books by Mark Twain and 10 books by Louisa May Alcott, amounting to 7,13,763 and 974,787 total words respectively. There are two word lexicons. One proxies for the domestic space, and contains 19 words such as “bed”, “knife”, “chair”, “table” and “sofa”. The other proxies for the outdoor space and contains 23 words such as “river”, “raft”, “sand”, “boat” and “mud”. On performing some basic descriptive stats, we find that the percentage of domestic words relative to total words is 0.22% for Twain and 0.22% for Alcott. The percentage of outdoor words relative to total words is 0.24% for Twain and 0.21% for Alcott. It is a very rudimentary finding, the limitations of which are discussed in the reflection. Nonetheless, it gives us a crude starting point - that the relative frequency of domestic words compared to outdoor words is slightly higher for Alcott and lower for Twain. This is also communicated graphically. We see below that the number of works by Twain with a relative frequency of 0 domestic words is slightly higher than that of those by Alcott.

```{r histogram_authors, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center"}
all_authors_frequency %>%
  ggplot(aes(relative_frequency, fill = author)) +
  geom_histogram(color = "black",
                 alpha = .5,
                 position = "identity")
```
```{r, include=FALSE}
all_authors_frequency %>%
  ggplot(aes(relative_frequency, fill = author))+ 
  geom_histogram(color = "black",
    alpha = .5,
    position = "identity")+
  facet_wrap(~author)
```

```{r frequency_buckets, include=FALSE}
all_authors_frequency %>%
  ggplot(aes(relative_frequency, fill = author))+ 
  geom_histogram(color = "black",
    alpha = .5,
    position = "identity",
    bins = 5)+
  labs(title = "Histogram",
       x = "Relative Frequency of Domestic Words",
       y = "Number of Texts",
       fill = "Author") +
  facet_wrap(~author)
```
```{r histogram_styled, include=FALSE}
all_authors_frequency %>%
  ggplot(aes(relative_frequency, fill = author))+ 
  geom_histogram(color = "black",
    alpha = .5,
    position = "identity",
    bins = 5)+
  labs(title = "Domestic Words by Author",
       x = "Relative Frequency of Domestic Words",
       y = "Number of Texts",
       fill = "Author") +
  facet_wrap(~author)
```
```{r chart_themes_538,include=FALSE}
all_authors_frequency %>%
  ggplot(aes(relative_frequency, fill = author)) +
  geom_histogram(
    color = "black",
    alpha = .5,
    position = "identity",
    bins = 5
  ) +
  labs(title = "Domestic Words by Author",
       x = "Relative Frequency of Domestic Words",
       y = "Number of Texts",
       fill = "Author") +
  facet_wrap( ~author) +
  theme_fivethirtyeight()
```

The contrast between usage of domestic and outdoor words is communicated through the graph below. It seems that Alcott is slightly more interested in the domestic space and Twain is slightly more interested in the outdoor space. Although there is not a dramatic difference, it sets us up to explore the sentiment around the two lexicons, given each author’s affiliation to write about the said spaces.

```{r histogram_domestic_outdoor, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center"}
all_authors_tagged %>%
  group_by(author, title) %>%
  #Run the same summary function, but instead of only creating one column                      create two.
  summarise(
    domestic = sum(domestic, na.rm = TRUE) / n(),
    outdoor = sum(outdoor, na.rm = TRUE) / n()
  ) %>%
  #Pivot the table longer and put the column names next to their relative                      frequency values.
  pivot_longer(domestic:outdoor,
               names_to = "concept",
               values_to = "relative_frequency") %>%
  #Clean up the variable by capitalizing them.
  mutate(author = str_to_title(author), concept =
           str_to_title(concept)) %>%
  ggplot(aes(relative_frequency, fill = author)) +
  geom_histogram(
    color = "black",
    alpha = .5,
    position = "identity",
    bins = 5
  ) +
  labs(title = "Domestic and Outdoor by Author",
       x = "Relative Frequency of Domestic and Outdoor Words",
       y = "Number of Texts",
       fill = "Author") +
  facet_wrap(vars(author, concept)) +
  theme_clean()
```

```{r sentences, include=FALSE}
twain_sentences <- twain %>%
  group_by(author,title,text) %>%
  summarise (text = paste(text, collapse = "")) %>%
  unnest_regex(sentences, text, pattern = "[.?!]", to_lower = FALSE)

louisa_sentences <- louisa %>%
  group_by(author,title,text) %>%
  summarise (text = paste(text, collapse = "")) %>%
  unnest_regex(sentences, text, pattern = "[.?!]", to_lower = FALSE)
```

```{r sentence_nr, include=FALSE}
twain_sentence_nr <- twain_sentences %>%
  ungroup() %>%
  mutate(sentence_number = row_number()) %>%
  group_by(author, title, sentence_number) %>%
  unnest_tokens(word, sentences) %>%
  anti_join(stop_words)

louisa_sentence_nr <- louisa_sentences %>%
  ungroup() %>%
  mutate(sentence_number = row_number()) %>%
  group_by(author, title, sentence_number) %>%
  unnest_tokens(word, sentences) %>%
  anti_join(stop_words)
```

```{r concept, include=FALSE}
twain_concept <- twain_sentence_nr %>%
  left_join(domestic_df) %>%
  left_join(outdoor_df)

louisa_concept <- louisa_sentence_nr %>%
  left_join(domestic_df) %>%
  left_join(outdoor_df)
```

```{r concept_sentiment, include=FALSE}
twain_concept_sentiment <- twain_concept %>%
  inner_join(get_sentiments("bing"))

louisa_concept_sentiment <- louisa_concept %>%
  inner_join(get_sentiments("bing"))
```

```{r sentiment_total, include=FALSE}
twain_sentiment_total <- twain_concept_sentiment %>%
  count(sentence_number, sentiment) %>%
  pivot_wider(names_from = sentiment,
              values_from = n,
              values_fill = 0)  %>%
  mutate(sentiment = positive - negative) %>%
  left_join(twain_concept) %>%
  filter(domestic == TRUE | outdoor == TRUE)

louisa_sentiment_total <- louisa_concept_sentiment %>%
  count(sentence_number, sentiment) %>%
  pivot_wider(names_from = sentiment,
              values_from = n,
              values_fill = 0)  %>%
  mutate(sentiment = positive - negative) %>%
  left_join(louisa_concept) %>%
  filter(domestic == TRUE | outdoor == TRUE)
```

```{r sentiment_table, include=FALSE}
twain_sentiment_table <- twain_sentiment_total %>%
  pivot_longer(domestic:outdoor,
               names_to = "concept",
               values_to = "total_sentiment")  %>%
  drop_na() %>%
  group_by(author, title, concept) %>%
  summarise (total = sum(sentiment)) %>%
  ungroup()

louisa_sentiment_table <- louisa_sentiment_total %>%
  pivot_longer(domestic:outdoor,
               names_to = "concept",
               values_to = "total_sentiment")  %>%
  drop_na() %>%
  group_by(author, title, concept) %>%
  summarise (total = sum(sentiment)) %>%
  ungroup()

sentiment_table <- rbind(twain_sentiment_table, louisa_sentiment_table)
sentiment_table
```

## Data Visualization 1 - Sentiment Analysis

After importing and cleaning the texts from gutenberg, we unnest the text to analyze the frequency of certain keywords in the text. We then convert the text into a set of sentences to analyze the sentiment of text around both indoor and outdoor spaces based on the predefined lexicon we have created. For this, we use the bing lexicon which characterises words into positive and negative sentiment, and tallies the total sentiment in the concepts. We then unnest these sentences into words and remove all the stop words to ensure that the results are not skewed one way or another. We then create a table with sentences of the texts having a positive or a negative sentiment attached to them. This is then used to give each sentence a count listing the total number of positive and negative sentiments. Then an aggregate sentiment is determined for each title written by Twain and Louisa.

Below is a numerical overview of the distribution of sentiment in the works of the two authors, taken together. Twain tends to write negatively about both the domestic and outdoor space. Louisa tends to write positively about the domestic space and is mixed in her sentiment around the outdoor space, where some works tend to be positive overall and others tend to be negative.

```{r sentiment_plot, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center"}
sentiment_table %>%
  ggplot(aes(author, y = total, fill=author)) +
  geom_col(color = "black",
           alpha = .7,
           position = "identity") +
  facet_wrap(~ concept) +
  labs(title = "Positive and Negative Sentiment by Concept",
       x = "Overall Sentiment",
       y = "author") +
  coord_flip() +
  theme_hc()
```

```{r bind rows_1, include=FALSE}
all_authors_sentiment_table <- bind_rows(twain_sentiment_table, louisa_sentiment_table)
```

```{r author_sentiment_plot, include=FALSE}
all_authors_sentiment_table %>%
  ggplot(aes(title, y = total, fill = author)) +
  geom_col(color = "black",
           alpha = .7,
           position = "identity") +
  facet_wrap(~ concept) +
  labs(title = "Domestic and Outdoor Sentiment by Concept",
       x = "Overal Sentiment",
       y = "titler",
       fill = "author") +
  coord_flip() 
```

We break down sentiment by individual works of the authors in the graph below. All of Twain’s works, except for “Tom Sawyer: Abroad”, are associated with a negative sentiment around the domestic space. As for the outdoors, it is portrayed negatively too, with no exceptions. While Twain seems to be writing negatively overall, it is interesting to see how the intensity of negativity around the domestic and the outdoor space move relative to each other, as we move from one book to another. If the intensity of negative sentiment around the domestic space  increases, that around the outdoor space decreases, and vice versa. While it is tempting to deduce a pattern from such an observation, it is not without its problems and shortcomings. The most glaring is the problem of absolute versus relative. The value shown is an aggregate of the sentiments surrounding concepts in the works. Thus, in addition to the sentiment, the value is influenced by, both, the choice of lexicon and the length of the books, giving us reason to be cautious in our analysis.

Alcott writes positively about the domestic space, with an exception of three works, that reveal a slightly negative sentiment. It’s interesting that one of these is titled “Little Men”. There is no clear indication of her sentiment surrounding the outdoors. 5 of her works have an overall positive and 5 have an overall negative sentiment around the outdoors. The three works that portray the domestic space negatively are among the list of works that portray the outdoors negatively, suggesting that maybe these works have a negative sentiment around space in general. Overall, the intensity of positivity is greater for the domestic space. These findings are relevant because they show that Alcott wrote more positively, irrespective of the space and Twain wrote more negatively, irrespective of the space, suggesting expected or accepted emotions from male and female authors writing at the time.

```{r final_chart, echo=FALSE, message=FALSE, warning=FALSE, fig.align="center"}
all_authors_sentiment_table %>%
  mutate(author = str_to_title(author)) %>%
  mutate(concept = str_to_title(concept)) %>%
  ggplot(aes(reorder(title, -total), y = total, fill = author)) +
  geom_col(color = "black",
           alpha = .7,
           position = "identity") +
  facet_wrap(~ concept) +
  labs(title = "Domestic and Outdoor Sentiment by Concept",
       x = "Overal Sentiment",
       y = "Title",
       fill = "author") +
  scale_fill_brewer(palette = "Dark2") +
  coord_flip() +
  theme_hc()
```

## Data Visualization 2 - NER

## Conclusion

## Reflection